<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>korsekode â€” ë¡œê·¸ì¸</title>
  <meta name="description" content="korsekode Local Login"/>
  <style>
    :root{
      --bg:#111827; --card:#0b1223; --ink:#e5e7eb; --muted:#9ca3af;
      --accent:#6f7dff; --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
      --border:rgba(255,255,255,.12); --radius:16px; --shadow:0 18px 60px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo","Noto Sans KR", sans-serif;
      background:
        radial-gradient(1200px 700px at 80% -10%, #3a2e8c 0%, rgba(58,46,140,0) 60%),
        radial-gradient(1000px 600px at -20% 120%, #2a246f 0%, rgba(42,36,111,0) 60%),
        var(--bg);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .wrap{ width:min(440px, 94vw); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px }
    h1{margin:0 0 6px; font-size:22px}
    p.lead{margin:0 0 14px; color:#d1d5db}
    label{font-size:12px; color:var(--muted); display:block; margin:8px 0 6px}
    input{
      width:100%; padding:12px; border-radius:12px; background:#0d0c2b; color:#fff;
      border:1px solid rgba(255,255,255,.12); outline:none; font-size:14px;
    }
    input:focus{ border-color:#8b95ff; box-shadow:0 0 0 3px rgba(139,149,255,.15) }
    .btn{
      width:100%; padding:12px; border-radius:12px; border:1px solid var(--border);
      background:linear-gradient(180deg, #7f8aff, #5f6bff); color:#fff; font-weight:800; cursor:pointer;
    }
    .btn.ghost{ background:transparent }
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .hint{font-size:12px; color:var(--muted)}
    .ok{color:var(--ok)} .err{color:var(--err)} .warn{color:var(--warn)}
    .sep{height:1px; background:var(--border); margin:16px 0}
    details{ background:rgba(255,255,255,.03); border:1px solid var(--border); padding:12px; border-radius:12px }
    summary{ cursor:pointer; font-weight:700 }
    .brand{font-weight:800}
  </style>
</head>
<body>
  <div class="wrap" role="main" aria-label="ë¡œê·¸ì¸ ë°•ìŠ¤">
    <h1><span class="brand">korsekode</span> ë¡œê·¸ì¸</h1>
    <p class="lead">ë‚´ë¶€ìš© ë¡œì»¬ ë¡œê·¸ì¸ì…ë‹ˆë‹¤. ì„±ê³µ ì‹œ ë©”ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>

    <label for="email">ì´ë©”ì¼</label>
    <input id="email" type="email" placeholder="you@company.com" autocomplete="username"/>

    <label for="pw">ë¹„ë°€ë²ˆí˜¸</label>
    <input id="pw" type="password" placeholder="ì˜ë¬¸+ìˆ«ì 8ì ì´ìƒ" autocomplete="current-password"/>

    <div class="row" style="margin:10px 0">
      <label class="hint" style="display:flex; align-items:center; gap:8px">
        <input id="keep" type="checkbox" checked/> ë¡œê·¸ì¸ ìœ ì§€(ìë™ ë¡œê·¸ì¸)
      </label>
      <button id="btnLogin" class="btn" style="max-width:160px">ë¡œê·¸ì¸</button>
    </div>
    <div id="msg" class="hint">Â· ë™ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.</div>

    <div class="sep"></div>

    <details>
      <summary>ìµœì´ˆ ë“±ë¡(ê³„ì •ì´ ì—†ì„ ë•Œ)</summary>
      <div style="margin-top:10px">
        <label for="regEmail">ì´ë©”ì¼</label>
        <input id="regEmail" type="email" placeholder="you@company.com" autocomplete="email"/>
        <div class="row" style="margin-top:10px">
          <div style="flex:1">
            <label for="regPw">ë¹„ë°€ë²ˆí˜¸</label>
            <input id="regPw" type="password" placeholder="8ì ì´ìƒ" autocomplete="new-password"/>
          </div>
          <div style="flex:1">
            <label for="regPw2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input id="regPw2" type="password" placeholder="ë‹¤ì‹œ ì…ë ¥" autocomplete="new-password"/>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="btnRegister" class="btn">ë“±ë¡</button>
          <button id="btnClear" class="btn ghost" style="max-width:140px">ì´ˆê¸°í™”</button>
        </div>
        <div id="regMsg" class="hint">Â· ë¡œì»¬ ì €ì¥: ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</div>
      </div>
    </details>
  </div>

  <script>
    // ===== ì„¤ì • =====
    const TARGET_URL = 'https://jjkim-png.github.io/korsekode_x2/'; // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™
    const KEY_EMAIL = 'kk_email';
    const KEY_HASH  = 'kk_hash';      // SHA-256(email|password) base64
    const KEY_KEEP  = 'kk_keep';
    const KEY_SESS  = 'kk_session';   // ì„¸ì…˜ ë¡œê·¸ì¸ í”Œë˜ê·¸

    const EMAIL_RE = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    const $ = (s)=>document.querySelector(s);
    const msg = $('#msg'); const regMsg = $('#regMsg');

    async function sha256Base64(text){
      const buf = new TextEncoder().encode(text);
      const hash = await crypto.subtle.digest('SHA-256', buf);
      const bytes = new Uint8Array(hash);
      // base64
      let bin = ''; bytes.forEach(b=> bin += String.fromCharCode(b));
      return btoa(bin);
    }

    function setMsg(el, text, cls='hint'){
      el.textContent = text;
      el.className = cls;
    }

    function isAuthed(){
      const keep = localStorage.getItem(KEY_KEEP) === '1';
      const sess = sessionStorage.getItem(KEY_SESS) === '1';
      return keep || sess;
    }

    function redirect(){ window.location.replace(TARGET_URL); }

    // ìë™ ë¡œê·¸ì¸
    (function auto(){
      if(isAuthed()){
        setMsg(msg, 'ìë™ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì´ë™í•©ë‹ˆë‹¤â€¦', 'hint ok');
        setTimeout(redirect, 300);
      }
    })();

    // ë¡œê·¸ì¸
    $('#btnLogin').addEventListener('click', async ()=>{
      const email = $('#email').value.trim();
      const pw = $('#pw').value;
      const keep = $('#keep').checked;

      if(!EMAIL_RE.test(email)) return setMsg(msg, 'âœ‹ ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'hint err');
      if((pw||'').length<8) return setMsg(msg, 'âœ‹ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'hint err');

      const storedEmail = localStorage.getItem(KEY_EMAIL);
      const storedHash  = localStorage.getItem(KEY_HASH);
      if(!storedEmail || !storedHash){
        return setMsg(msg, 'ë“±ë¡ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ â€œìµœì´ˆ ë“±ë¡â€ì—ì„œ ë¨¼ì € ê³„ì •ì„ ë§Œë“œì„¸ìš”.', 'hint warn');
      }
      const inputHash = await sha256Base64(`${email}|${pw}`);
      if(email!==storedEmail || inputHash!==storedHash){
        return setMsg(msg, 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'hint err');
      }

      if(keep){
        localStorage.setItem(KEY_KEEP, '1');     // ì˜êµ¬ ìœ ì§€
        sessionStorage.setItem(KEY_SESS, '1');   // í˜„ì¬ íƒ­ ì¦‰ì‹œ ì¸ì¦
      }else{
        localStorage.removeItem(KEY_KEEP);
        sessionStorage.setItem(KEY_SESS, '1');   // ì„¸ì…˜ë§Œ ìœ ì§€
      }
      setMsg(msg, 'âœ… ë¡œê·¸ì¸ ì„±ê³µ. ì´ë™í•©ë‹ˆë‹¤â€¦', 'hint ok');
      setTimeout(redirect, 250);
    });

    // ë“±ë¡
    $('#btnRegister').addEventListener('click', async ()=>{
      const email = $('#regEmail').value.trim();
      const pw = $('#regPw').value;
      const pw2 = $('#regPw2').value;

      if(!EMAIL_RE.test(email)) return setMsg(regMsg, 'âœ‹ ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'hint err');
      if((pw||'').length<8) return setMsg(regMsg, 'âœ‹ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'hint err');
      if(pw!==pw2) return setMsg(regMsg, 'âœ‹ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'hint err');

      const hash = await sha256Base64(`${email}|${pw}`);
      localStorage.setItem(KEY_EMAIL, email);
      localStorage.setItem(KEY_HASH, hash);
      setMsg(regMsg, 'âœ… ë“±ë¡ ì™„ë£Œ. ìƒë‹¨ ë¡œê·¸ì¸ ì„¹ì…˜ì—ì„œ ë¡œê·¸ì¸í•˜ì„¸ìš”.', 'hint ok');
    });

    // ì´ˆê¸°í™”
    $('#btnClear').addEventListener('click', ()=>{
      if(confirm('ë¡œì»¬ì— ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì‚­ì œí• ê¹Œìš”?')){
        localStorage.removeItem(KEY_EMAIL);
        localStorage.removeItem(KEY_HASH);
        localStorage.removeItem(KEY_KEEP);
        sessionStorage.removeItem(KEY_SESS);
        setMsg(regMsg, 'ğŸ—‘ï¸ ì´ˆê¸°í™” ì™„ë£Œ. ìƒˆë¡œìš´ ê³„ì •ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'hint ok');
        setMsg(msg, 'Â· ë™ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.', 'hint');
      }
    });

    // Enter ì œì¶œ
    ['email','pw','regEmail','regPw','regPw2'].forEach(id=>{
      const el = document.getElementById(id);
      el?.addEventListener('keydown', (e)=>{
        if(e.key==='Enter'){
          if(id.startsWith('reg')) $('#btnRegister').click();
          else $('#btnLogin').click();
        }
      });
    });
  </script>
</body>
</html>
