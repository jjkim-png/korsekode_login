<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Kodeck — On‑Course Quick Log (v1)</title>
  <style>
    :root{
      --bg:#0b0f14;      /* deep navy for glare control */
      --ink:#e8ecf1;     /* high-contrast text */
      --muted:#9aa5b1;   
      --accent:#58a6ff;  /* focus ring */
      --ok:#10b981;      /* GIR / success */
      --warn:#f59e0b;    /* miss */
      --bad:#ef4444;     /* penalty */
      --card:#11161d;    /* panels */
      --chip:#1a212b;    /* chip bg */
      --border:#202a36;
      --btn:#1f2937;     /* buttons */
      --btnActive:#334155;
      --radius:18px;
      --shadow:0 10px 24px rgba(0,0,0,.35);
      --tap:20px; /* big hit area */
    }

    html,body{height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans,Arial,sans-serif;}
    *{box-sizing:border-box}
    button{appearance:none;border:0;cursor:pointer}

    .wrap{max-width:820px;margin:0 auto;padding:16px 16px 120px}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,15,20,.95),rgba(11,15,20,.75));backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
    .top{
      display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px 8px
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{font-size:16px;margin:0;font-weight:700;letter-spacing:.3px}
    .tag{font-size:12px;color:var(--muted)}

    .bar{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;padding:8px}
    .dot{height:16px;border-radius:8px;background:var(--chip);border:1px solid var(--border)}
    .dot.ok{background:linear-gradient(180deg,#065f46,#10b981)}
    .dot.warn{background:linear-gradient(180deg,#7c2d12,#f59e0b)}
    .dot.bad{background:linear-gradient(180deg,#7f1d1d,#ef4444)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;margin-top:12px}
    .section-title{font-size:13px;color:var(--muted);letter-spacing:.3px;margin:0 0 8px 2px}

    .row{display:flex;flex-wrap:wrap;gap:8px}
    .row > *{flex:1 1 auto}

    .slot{background:var(--chip);border:1px solid var(--border);border-radius:14px;padding:10px}
    .slot h3{font-size:13px;color:var(--muted);margin:0 0 6px}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .grid-5{grid-template-columns:repeat(5,1fr)}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    .grid-2{grid-template-columns:repeat(2,1fr)}

    .btn{background:var(--btn);border:1px solid var(--border);border-radius:12px;padding:14px 10px;text-align:center;font-weight:700;font-size:16px;line-height:1;min-height:54px}
    .btn.small{padding:10px;font-size:14px;min-height:44px}
    .btn:active{transform:translateY(1px)}
    .btn[aria-pressed="true"], .btn.active{background:var(--btnActive);outline:2px solid var(--accent)}
    .btn.ok{background:#064e3b;border-color:#065f46}

    .pill{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border:1px solid var(--border);padding:8px 10px;border-radius:999px}
    .pill input{all:unset;width:64px;text-align:center;font-weight:700;font-size:16px}
    .pill .lab{font-size:12px;color:var(--muted)}

    .hole-head{display:flex;justify-content:space-between;align-items:center}
    .hole-num{font-size:18px;font-weight:800}
    .hole-ctrl{display:flex;gap:8px}
    .ghost{opacity:.75}

    textarea{width:100%;min-height:72px;background:#0e141c;color:var(--ink);border:1px solid var(--border);border-radius:12px;padding:10px}

    .toolbar{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(11,15,20,.2),rgba(11,15,20,.9));backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:10px}
    .tools{display:flex;gap:8px}
    .tools .btn{flex:1}

    .tiny{font-size:11px;color:var(--muted)}
    .inline{display:inline-flex;gap:8px;align-items:center}
    .spacer{height:80px}

    .lang{font-size:12px;color:var(--muted);}
  </style>
</head>
<body>
<header>
  <div class="top">
    <div class="brand">
      <h1>kodeck — on‑course</h1>
      <span class="tag" id="version">v1</span>
    </div>
    <div class="inline lang">
      <label><input type="checkbox" id="langToggle"/> EN</label>
      <button class="btn small" id="importBtn" title="가져오기 / Import">↥ JSON</button>
      <button class="btn small" id="exportBtn" title="내보내기 / Export">↧ JSON/CSV</button>
    </div>
  </div>
  <div class="bar" id="progressBar"></div>
</header>

<div class="wrap">
  <div class="card">
    <div class="row" style="align-items:flex-end">
      <div style="flex:1 1 160px">
        <label class="section-title" data-t="player">선수 ID</label>
        <input id="playerId" class="pill" placeholder="e.g. C22001"/>
      </div>
      <div style="flex:1 1 160px">
        <label class="section-title" data-t="course">코스명</label>
        <input id="courseName" class="pill" placeholder="e.g. OCN Panther"/>
      </div>
      <div style="flex:0 0 auto">
        <div class="pill">
          <span class="lab" data-t="holes">홀 수</span>
          <input id="holeCount" type="number" min="3" max="27" value="18"/>
        </div>
      </div>
      <div class="hole-ctrl">
        <button class="btn small" id="prevHole">◀︎</button>
        <div class="pill"><span class="lab">Hole</span><input id="holeNum" type="number" min="1" value="1"/></div>
        <button class="btn small" id="nextHole">▶︎</button>
      </div>
    </div>
  </div>

  <!-- TEE BOX -->
  <div class="card">
    <div class="hole-head">
      <div class="hole-num" id="holeLabel">HOLE 1</div>
      <div class="tiny ghost" id="holeStatus">—</div>
    </div>
    <h2 class="section-title" data-t="tee">티샷</h2>
    <div class="row">
      <div class="slot" style="flex:2">
        <h3 data-t="club">클럽</h3>
        <div class="grid grid-5" id="clubBtns"></div>
      </div>
      <div class="slot" style="flex:3">
        <h3 data-t="teeRes">결과</h3>
        <div class="grid" id="teeResBtns"></div>
      </div>
    </div>
  </div>

  <!-- APPROACH / NEXT SHOT -->
  <div class="card">
    <h2 class="section-title" data-t="approach">어프로치</h2>
    <div class="row">
      <div class="slot" style="flex:2">
        <h3 data-t="distToPin">핀까지 거리 (yd)</h3>
        <div class="pill"><input id="dist" inputmode="numeric" pattern="[0-9]*" placeholder="150"/><span class="lab">yd</span></div>
      </div>
      <div class="slot" style="flex:1.2">
        <h3 data-t="target">목표</h3>
        <div class="grid grid-3" id="targetBtns"></div>
      </div>
      <div class="slot" style="flex:1.8">
        <h3 data-t="apRes">결과</h3>
        <div class="grid" id="apResBtns"></div>
      </div>
    </div>
  </div>

  <!-- GREEN / SHORT GAME -->
  <div class="card">
    <h2 class="section-title" data-t="green">그린 & 퍼팅</h2>
    <div class="row">
      <div class="slot" style="flex:2">
        <h3 data-t="gir">GIR</h3>
        <div class="grid grid-2">
          <button class="btn" data-bind="gir" data-val="Y">YES</button>
          <button class="btn" data-bind="gir" data-val="N">NO</button>
        </div>
      </div>
      <div class="slot" style="flex:2">
        <h3 data-t="firstPutt">첫 퍼트 거리 (ft)</h3>
        <div class="pill"><input id="firstPutt" inputmode="numeric" pattern="[0-9]*" placeholder="15"/><span class="lab">ft</span></div>
      </div>
      <div class="slot" style="flex:2">
        <h3 data-t="putts">퍼트 수</h3>
        <div class="grid grid-4">
          <button class="btn" data-bind="putts" data-val="0">0</button>
          <button class="btn" data-bind="putts" data-val="1">1</button>
          <button class="btn" data-bind="putts" data-val="2">2</button>
          <button class="btn" data-bind="putts" data-val="3">3+</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SHORT GAME BRANCH (appears if GIR = N) -->
  <div class="card" id="sgCard" style="display:none">
    <h2 class="section-title" data-t="shortGame">쇼트게임</h2>
    <div class="row">
      <div class="slot" style="flex:2">
        <h3 data-t="sgLie">라이</h3>
        <div class="grid grid-3" id="sgLieBtns"></div>
      </div>
      <div class="slot" style="flex:2">
        <h3 data-t="sgStrokes">그린까지 타수</h3>
        <div class="grid grid-3">
          <button class="btn" data-bind="sgStrokes" data-val="1">1</button>
          <button class="btn" data-bind="sgStrokes" data-val="2">2</button>
          <button class="btn" data-bind="sgStrokes" data-val="3">3+</button>
        </div>
      </div>
      <div class="slot" style="flex:2">
        <h3 data-t="leave">남은 거리 (ft)</h3>
        <div class="pill"><input id="leaveFt" inputmode="numeric" pattern="[0-9]*" placeholder="4"/><span class="lab">ft</span></div>
      </div>
    </div>
  </div>

  <!-- PENALTIES / NOTES -->
  <div class="card">
    <h2 class="section-title" data-t="penalty">패널티 & 메모</h2>
    <div class="row">
      <div class="slot" style="flex:2">
        <h3 data-t="pen">패널티</h3>
        <div class="grid grid-3" id="penBtns"></div>
      </div>
      <div class="slot" style="flex:3">
        <h3 data-t="note">메모</h3>
        <textarea id="notes" placeholder="바람, 경사, 선택 이유 등"></textarea>
      </div>
    </div>
  </div>

  <div class="spacer"></div>
</div>

<!-- BOTTOM TOOLBAR -->
<div class="toolbar">
  <div class="tools">
    <button class="btn" id="undoBtn">↶ 되돌리기</button>
    <button class="btn" id="clearBtn">홀 초기화</button>
    <button class="btn ok" id="saveBtn">저장 & 다음 홀 ▶︎</button>
  </div>
</div>

<script>
(function(){
  const $ = (sel)=>document.querySelector(sel);
  const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
  const L = (k)=> i18n[state.lang][k] || k;

  const i18n = {
    ko:{
      player:'선수 ID', course:'코스명', holes:'홀 수', tee:'티샷', club:'클럽', teeRes:'결과',
      approach:'어프로치', distToPin:'핀까지 거리 (yd)', target:'목표', apRes:'결과',
      green:'그린 & 퍼팅', gir:'GIR', firstPutt:'첫 퍼트 거리 (ft)', putts:'퍼트 수',
      shortGame:'쇼트게임', sgLie:'라이', sgStrokes:'그린까지 타수', leave:'남은 거리 (ft)',
      penalty:'패널티 & 메모', pen:'패널티', note:'메모'
    },
    en:{
      player:'Player ID', course:'Course', holes:'Holes', tee:'Tee Shot', club:'Club', teeRes:'Result',
      approach:'Approach', distToPin:'Dist to Pin (yd)', target:'Target', apRes:'Result',
      green:'Green & Putting', gir:'GIR', firstPutt:'First Putt (ft)', putts:'Putts',
      shortGame:'Short Game', sgLie:'Lie', sgStrokes:'Strokes to Green', leave:'Leave (ft)',
      penalty:'Penalties & Notes', pen:'Penalty', note:'Notes'
    }
  };

  const clubs = ['D','3W','5W','UT','4I','5I','6I','7I','8I','9I','PW','GW','SW','LW'];
  const teeResults = [
    {k:'FW', lab:'페어웨이'},
    {k:'R',  lab:'러프'},
    {k:'B',  lab:'벙커'},
    {k:'T',  lab:'나무/정글'},
    {k:'O',  lab:'OB'},
    {k:'H',  lab:'해저드'}
  ];
  const targets = [
    {k:'safeL',lab:'세이프 L'},
    {k:'pin',  lab:'핀'},
    {k:'safeR',lab:'세이프 R'}
  ];
  const apResults = [
    {k:'G', lab:'온그린'},
    {k:'L', lab:'좌 미스'},
    {k:'R', lab:'우 미스'},
    {k:'S', lab:'짧음'},
    {k:'LNG',lab:'긺'},
  ];
  const sgLies = [
    {k:'FW',lab:'페어웨이'},
    {k:'RF',lab:'러프'},
    {k:'BK',lab:'벙커'},
  ];
  const pens = [
    {k:'OB',lab:'OB +1'},
    {k:'HZ',lab:'해저드 +1'},
    {k:'UP',lab:'언플 +1'}
  ];

  let state = {
    lang:'ko',
    hole:1,
    holeCount:18,
    stack:[], // for undo
  };

  // Initialize dynamic buttons
  function makeButtons(list, mountSel, bindKey){
    const host = typeof mountSel==='string'? $(mountSel): mountSel;
    host.innerHTML = '';
    list.forEach(item=>{
      const b=document.createElement('button');
      b.className='btn';
      b.textContent=item.lab||item;
      b.dataset.val=item.k||item;
      if(bindKey) b.dataset.bind=bindKey;
      b.addEventListener('click',()=>toggleBtn(b, bindKey));
      host.appendChild(b);
    });
  }
  makeButtons(clubs, '#clubBtns', 'club');
  makeButtons(teeResults, '#teeResBtns', 'tee');
  makeButtons(targets, '#targetBtns', 'target');
  makeButtons(apResults, '#apResBtns', 'ap');
  makeButtons(sgLies, '#sgLieBtns', 'sgLie');
  makeButtons(pens, '#penBtns', 'pen');

  function toggleBtn(btn, key){
    // single-select per group except penalties (multi)
    const multi = key==='pen';
    const group = $$(`[data-bind="${key}"]`);
    if(!multi){ group.forEach(x=>x.removeAttribute('aria-pressed')); }
    const pressed = btn.getAttribute('aria-pressed')==='true';
    btn.setAttribute('aria-pressed', (!pressed).toString());
    if(!multi){
      // store immediately
      setField(key, (!pressed)? btn.dataset.val: null);
    } else {
      // toggle presence in penalties
      const cur = getHole().penalties || [];
      const val = btn.dataset.val;
      const i = cur.indexOf(val);
      if(i>-1){ cur.splice(i,1);} else {cur.push(val);}
      setField('penalties', cur);
    }
    refreshStatus();
  }

  // Storage helpers
  const KEY = 'kodeck_round_v1';
  function load(){
    const raw=localStorage.getItem(KEY);
    return raw? JSON.parse(raw): {
      meta:{ playerId:'', course:'', date:new Date().toISOString().slice(0,10) },
      holes:{} // id -> partials
    };
  }
  function save(obj){ localStorage.setItem(KEY, JSON.stringify(obj)); }
  function getRound(){ return load(); }
  function getHole(n=state.hole){ const r=getRound(); return r.holes[n]||(r.holes[n]={}); }
  function setHole(n, data){ const r=getRound(); r.holes[n]=Object.assign({}, r.holes[n]||{}, data); save(r); }
  function setField(key, val){ const h=getHole(); if(val===null){ delete h[key]; } else { h[key]=val; } setHole(state.hole,h); }

  // UI bindings
  function syncMeta(){
    const r=getRound();
    $('#playerId').value=r.meta.playerId||'';
    $('#courseName').value=r.meta.course||'';
    $('#holeCount').value=state.holeCount;
  }
  function writeMeta(){
    const r=getRound();
    r.meta.playerId=$('#playerId').value.trim();
    r.meta.course=$('#courseName').value.trim();
    r.meta.date=r.meta.date||new Date().toISOString().slice(0,10);
    save(r);
  }

  function go(n){
    writeMeta();
    const max = parseInt($('#holeCount').value||'18',10);
    state.holeCount = Math.max(3, Math.min(27, max));
    state.hole = Math.max(1, Math.min(state.holeCount, n));
    $('#holeNum').value = state.hole;
    $('#holeLabel').textContent = `HOLE ${state.hole}`;
    renderHole();
    renderDots();
  }

  function renderDots(){
    const host = $('#progressBar');
    host.innerHTML='';
    const r = getRound();
    for(let i=1;i<=state.holeCount;i++){
      const d = r.holes[i];
      const el=document.createElement('div');
      el.className='dot';
      if(d){
        const cls = d.putts!=null? 'ok' : (d.penalties&&d.penalties.length? 'bad':'warn');
        el.classList.add(cls);
      }
      host.appendChild(el);
    }
  }

  function renderHole(){
    // clear actives
    $$('[aria-pressed]').forEach(x=>x.removeAttribute('aria-pressed'));
    const h = getHole();
    // set actives from state
    ['club','tee','target','ap','gir','putts','sgStrokes','sgLie'].forEach(k=>{
      if(h[k]!=null){ const b = $(`[data-bind="${k}"][data-val="${h[k]}"]`); if(b) b.setAttribute('aria-pressed','true'); }
    });
    if(h.penalties){ h.penalties.forEach(p=>{ const b=$(`[data-bind="pen"][data-val="${p}"]`); if(b) b && b.setAttribute('aria-pressed','true');}); }
    $('#dist').value = h.dist||'';
    $('#firstPutt').value = h.firstPutt||'';
    $('#leaveFt').value = h.leaveFt||'';
    $('#notes').value = h.notes||'';
    $('#sgCard').style.display = h.gir==='N'? 'block':'none';
    refreshStatus();
  }

  function refreshStatus(){
    const h = getHole();
    const parts = [];
    if(h.club) parts.push(`Tee:${h.club}`);
    if(h.tee) parts.push(h.tee);
    if(h.ap) parts.push(h.ap);
    if(h.gir) parts.push(`GIR:${h.gir}`);
    if(h.putts!=null) parts.push(`${h.putts}P`);
    if(h.penalties&&h.penalties.length) parts.push('PEN');
    $('#holeStatus').textContent = parts.join(' · ') || '—';
  }

  // inputs
  $('#dist').addEventListener('change', e=>setField('dist', num(e.target.value)));
  $('#firstPutt').addEventListener('change', e=>setField('firstPutt', num(e.target.value)));
  $('#leaveFt').addEventListener('change', e=>setField('leaveFt', num(e.target.value)));
  $('#notes').addEventListener('change', e=>setField('notes', e.target.value));

  $('#holeNum').addEventListener('change', e=>go(parseInt(e.target.value||'1',10)));
  $('#prevHole').addEventListener('click', ()=>go(state.hole-1));
  $('#nextHole').addEventListener('click', ()=>go(state.hole+1));
  $('#holeCount').addEventListener('change', ()=>{ renderDots(); go(state.hole); });

  // bind generic buttons by delegation
  document.body.addEventListener('click', (e)=>{
    const t=e.target.closest('[data-bind]');
    if(!t) return;
    const key=t.dataset.bind;
    const val=t.dataset.val;
    if(key==='gir'){
      setField('gir', val);
      $('#sgCard').style.display = val==='N'? 'block':'none';
    } else if(key==='putts'){
      setField('putts', parseInt(val,10));
    } else if(key==='sgStrokes'){
      setField('sgStrokes', parseInt(val,10));
    } else if(key==='club' || key==='tee' || key==='target' || key==='ap' || key==='sgLie'){
      setField(key, val);
    }
    refreshStatus();
  });

  // actions
  $('#undoBtn').addEventListener('click', ()=>{
    const r=getRound();
    const h=r.holes[state.hole]||{};
    state.stack.push(JSON.stringify(h));
    // heuristic undo: remove last set field based on priority
    const order=['notes','penalties','putts','firstPutt','leaveFt','sgStrokes','sgLie','gir','ap','target','dist','tee','club'];
    for(const k of order){ if(h[k]!=null){ delete h[k]; break; } }
    setHole(state.hole,h); renderHole();
  });
  $('#clearBtn').addEventListener('click', ()=>{ setHole(state.hole, {}); renderHole(); });
  $('#saveBtn').addEventListener('click', ()=>{ writeMeta(); go(state.hole+1); });

  // import / export
  $('#exportBtn').addEventListener('click', ()=>{
    const r = getRound();
    const payload = toBridgeJSON(r);
    const csv = toCSV(payload);
    const blobJson = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
    const blobCsv = new Blob([csv], {type:'text/csv'});
    download(blobJson, `kodeck_${r.meta.playerId||'player'}_${r.meta.date}.json`);
    setTimeout(()=>download(blobCsv, `kodeck_${r.meta.playerId||'player'}_${r.meta.date}.csv`), 250);
  });
  $('#importBtn').addEventListener('click', ()=>{
    const inp=document.createElement('input');
    inp.type='file'; inp.accept='.json';
    inp.onchange=(e)=>{
      const f=e.target.files[0];
      const rd=new FileReader();
      rd.onload=()=>{
        try{ const data=JSON.parse(rd.result); fromBridgeJSON(data); renderDots(); renderHole(); }
        catch(err){ alert('JSON 파싱 오류'); }
      };
      rd.readAsText(f);
    };
    inp.click();
  });

  // language toggle
  $('#langToggle').addEventListener('change', (e)=>{
    state.lang = e.target.checked? 'en':'ko';
    $$('[data-t]').forEach(el=>{ const k=el.getAttribute('data-t'); el.textContent=L(k); });
  });

  // helpers
  function num(v){ const n=parseInt(v,10); return isFinite(n)? n: '' }
  function download(blob, filename){
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob); a.download=filename; a.click();
    URL.revokeObjectURL(a.href);
  }

  // Export schema (BRIDGE → compatible, minimal fields for later full SG in Korsekode)
  function toBridgeJSON(r){
    const holes=[];
    for(let i=1;i<= (r.meta.holeCount||state.holeCount); i++){
      const h=r.holes[i]||{};
      holes.push({
        hole:i,
        par:null,             // optional later fill
        tee:{ club:h.club||null, result:h.tee||null },
        approach:{ dist_yd: h.dist||null, target:h.target||null, result:h.ap||null },
        green:{ gir: h.gir||null, first_putt_ft: h.firstPutt||null, putts: (h.putts!=null? h.putts: null) },
        short_game: h.gir==='N'? { lie:h.sgLie||null, strokes_to_green:h.sgStrokes||null, leave_ft:h.leaveFt||null } : null,
        penalties: h.penalties||[],
        notes: h.notes||''
      });
    }
    return {
      meta:{ player_id:r.meta.playerId, course:r.meta.course, date:r.meta.date, holes: r.meta.holeCount||state.holeCount },
      holes
    };
  }

  function toCSV(payload){
    const header=['player_id','course','date','hole','tee_club','tee_res','ap_dist_yd','ap_target','ap_res','gir','sg_lie','sg_strokes','sg_leave_ft','first_putt_ft','putts','penalties','notes'];
    const L=[]; L.push(header.join(','));
    payload.holes.forEach(h=>{
      L.push([
        payload.meta.player_id,
        payload.meta.course,
        payload.meta.date,
        h.hole,
        val(h.tee?.club),
        val(h.tee?.result),
        val(h.approach?.dist_yd),
        val(h.approach?.target),
        val(h.approach?.result),
        val(h.green?.gir),
        val(h.short_game?.lie),
        val(h.short_game?.strokes_to_green),
        val(h.short_game?.leave_ft),
        val(h.green?.first_putt_ft),
        val(h.green?.putts),
        (h.penalties||[]).join('|'),
        '"'+(h.notes||'').replaceAll('"','\"')+'"'
      ].join(','));
    });
    return L.join('\n');
    function val(x){ return (x==null? '': x); }
  }

  function fromBridgeJSON(payload){
    const r = {meta:{ playerId: payload.meta.player_id||'', course: payload.meta.course||'', date: payload.meta.date||new Date().toISOString().slice(0,10), holeCount: payload.meta.holes||18 }, holes:{} };
    payload.holes.forEach(h=>{
      r.holes[h.hole] = {
        club: h.tee?.club||null,
        tee: h.tee?.result||null,
        dist: h.approach?.dist_yd||null,
        target: h.approach?.target||null,
        ap: h.approach?.result||null,
        gir: h.green?.gir||null,
        firstPutt: h.green?.first_putt_ft||null,
        putts: h.green?.putts?? null,
        sgLie: h.short_game?.lie||null,
        sgStrokes: h.short_game?.strokes_to_green||null,
        leaveFt: h.short_game?.leave_ft||null,
        penalties: h.penalties||[],
        notes: h.notes||''
      };
    });
    save(r);
    state.holeCount = r.meta.holeCount||18;
    $('#holeCount').value = state.holeCount;
  }

  // kick
  syncMeta();
  renderDots();
  renderHole();
})();
</script>
</body>
</html>
